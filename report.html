<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ACCAPP</title>
    <link rel="icon" type="image/png" href="images/accapp.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.4.24/sweetalert2.all.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>  <!-- jsPDF first -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>  <!-- jsPDF-AutoTable after -->


  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- header -->
    <nav class="navbar bg-body-info fixed-top"  style="background-color:#055de6;">
      <div class="container-fluid">
        <a class="navbar-brand" href="dashboard.html" style="color: whitesmoke;">ACADEMIC CONCERN AND CONSULTATION SCHEDULING SYSTEM</a>

        <a class="nav-link active" aria-current="page" href="#" id="userDetails"></a><br/>
        <button class="btn btn-outline-primary" type="button" id="signOutBtn">Sign Out</button>
        
      </div>
    </nav>
    <!-- end of header -->
    
    <!-- menu -->
     <br/><br/><br/>
     <div class="container-fluid">
        <ul class="nav nav-tabs">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="dashboard.html">Dashboard</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Maintenance</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="adduser.html">+User</a></li>
                <li><a class="dropdown-item" href="addfaculty.html">Faculty</a></li>
                <li><a class="dropdown-item" href="addstudent.html">Student</a></li>
              </ul>
            </li>
            <li class="nav-item dropdown"></li>
                <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Consultation</a>
                <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="facultysched.html">Faculty Availability</a></li>
                  <li><a class="dropdown-item" href="studreq.html">Student Request</a></li>
                  <li><a class="dropdown-item" href="studreqdecline.html">Student Request Declined</a></li>
                  <li><a class="dropdown-item" href="sfcon.html">Student and Faculty</a></li>
                </ul>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Concern</a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="compstudent.html">by Student</a></li>
                  <li><a class="dropdown-item" href="compfaculty.html">by Faculty</a></li>
                </ul>
              </li>
              <li class="nav-item"></li>
              <a class="nav-link" href="callteacher.html">Calling Teacher</a>
              </li>
              <li class="nav-item active"></li>
                <a class="nav-link active" href="report.html">Reports</a>
              </li>
              
            
          </ul>
     </div>
    <!-- end of  menu -->

    <!-- content -->
    <br/>
    <div class="container-fluid">
        <div class="container text-center">
            <div class="row">
              <div class="col-6 rounded-4 border border-success p-2 mb-2">
                <h3>Reports</h3>
               <p>(downloadable in PDF format)</p>
               <br/>
               <a href="#" id="downloadLink">List of System Users</a><br/>
               <a href="#" id="downloadLink2">List of Faculty Members</a><br/>
               <a href="#" id="downloadLink3">List of Students</a><br/><br/>

               <a href="#" id="downloadLink4">List of Faculty Availability</a><br/>
               <a href="#" id="downloadLink5">List of Student Request</a><br/>
               <a href="#" id="downloadLink10">List of Student Request DECLINED</a><br/>
               <a href="#" id="downloadLink6">List of Student and Faculty Consultation</a><br/><br/>

               <a href="#" id="downloadLink7">List of Concern by Student</a><br/>
               <a href="#" id="downloadLink8">List of Concern by Faculty</a><br/><br/>

               <a href="#" id="downloadLink9">List of Calling Teacher Notification</a><br/>
              </div>
            </div>
          </div>
    </div>
    <!-- end of content -->

    <script type="module">
       import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
      import { getFirestore,  doc, getDocs, collection } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";
      import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyC23VFp5TVrteSahdnLyuGMkJg8R2EjVWw",
        authDomain: "accapp-a65e4.firebaseapp.com",
        //databaseURL: "https://accapp-a65e4-default-rtdb.firebaseio.com/",
        projectId: "accapp-a65e4",
        storageBucket: "accapp-a65e4.appspot.com",
        messagingSenderId: "703785259381",
        appId: "1:703785259381:web:77a5728e081d078152c33c",
        measurementId: "G-1R6LN7C9EV"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

//----
      // Reference to Complaint Student collection
      const collectionRef10 = collection(db, 'DeclineConsultations');

      // Generate and download PDF on link click
      document.getElementById('downloadLink10').addEventListener('click', async (event) => {
       event.preventDefault();  // Prevent link default behavior
       
       // Access jsPDF from the global namespace
       const { jsPDF } = window.jspdf;
       const doc = new jsPDF(); // Create a new jsPDF instance

       // Fetch data from Firestore collection
       try {
           const querySnapshot =  await getDocs(collectionRef10);

           // Prepare the table header and rows
           const tableHeaders = ['Date', 'Time', 'Teacher Name' ,'Student Name', 'Status', 'When', 'Remarks']; // Define the table headers
           const tableRows = []; // Array to hold the table rows

           // Loop through the Firestore documents and add them as rows
           querySnapshot.forEach((docSnapshot) => {
               const data = docSnapshot.data();
               const rowData = [];

               // Add details if it exists, else add a placeholder
               rowData.push(data.ConsultationDate || 'N/A');
               rowData.push(data.ConsultationStartEndTime || 'N/A');
               rowData.push(data.TeacherName || 'N/A');
               rowData.push(data.StudentName || 'N/A');
               rowData.push(data.ConsultationRequestStatus || 'N/A');
               rowData.push(data.DeclineDateTime || 'N/A');
               rowData.push(data.ReasonofDecline || 'N/A');

               // Add the row to the table
               tableRows.push(rowData);
           });

           // Define header and footer rendering functions
           const header = (data) => {
               doc.setFontSize(12);
               doc.text('ACADEMIC CONCERN AND CONSULTATION SCHEDULING SYSTEM', data.settings.margin.left, 10);  // Custom header text
               doc.setFontSize(10);
               doc.text('List of Student Request Consultation - DECLINED', data.settings.margin.left, 15);  // Custom header text

           };

           const footer = (data) => {
               let pageCount = doc.internal.getNumberOfPages();
               doc.setFontSize(10);
               doc.text(`Page ${data.pageNumber} of ${pageCount}`, data.settings.margin.left, doc.internal.pageSize.height - 10);
           };

           // Generate PDF with AutoTable and include header/footer
           doc.autoTable({
               head: [tableHeaders],      // Table headers
               body: tableRows,           // Table rows
               startY: 20,                // Start position on Y-axis
               margin: { top: 20 },       // Adjust top margin for header
               didDrawPage: (data) => {   // Add header and footer on each page
                   header(data);          // Call header function
                   footer(data);          // Call footer function
               }
           });


           // Save and download the generated PDF
           doc.save('list of declineconsultation.pdf'); // Automatically downloads the file as 'firestore-data.pdf'
       } catch (error) {
           console.error('Error generating PDF from Firestore: ', error);
       }
   });

//----
      // Reference to Complaint Student collection
      const collectionRef9 = collection(db, 'CallMyTeacher');

      // Generate and download PDF on link click
      document.getElementById('downloadLink9').addEventListener('click', async (event) => {
       event.preventDefault();  // Prevent link default behavior
       
       // Access jsPDF from the global namespace
       const { jsPDF } = window.jspdf;
       const doc = new jsPDF(); // Create a new jsPDF instance

       // Fetch data from Firestore collection
       try {
           const querySnapshot =  await getDocs(collectionRef9);

           // Prepare the table header and rows
           const tableHeaders = ['Date', 'Time', 'Teacher Name' ,'Student Name','Message', 'Status', 'Remarks']; // Define the table headers
           const tableRows = []; // Array to hold the table rows

           // Loop through the Firestore documents and add them as rows
           querySnapshot.forEach((docSnapshot) => {
               const data = docSnapshot.data();
               const rowData = [];

               // Add details if it exists, else add a placeholder
               rowData.push(data.Date || 'N/A');
               rowData.push(data.Time || 'N/A');
               rowData.push(data.TeacherName || 'N/A');
               rowData.push(data.StudentName || 'N/A');
               rowData.push(data.Message || 'N/A');
               rowData.push(data.Status || 'N/A');
               rowData.push(data.Remarks || 'N/A');

               // Add the row to the table
               tableRows.push(rowData);
           });

           // Define header and footer rendering functions
           const header = (data) => {
               doc.setFontSize(12);
               doc.text('ACADEMIC CONCERN AND CONSULTATION SCHEDULING SYSTEM', data.settings.margin.left, 10);  // Custom header text
               doc.setFontSize(10);
               doc.text('List of Calling Teacher Notification', data.settings.margin.left, 15);  // Custom header text

           };

           const footer = (data) => {
               let pageCount = doc.internal.getNumberOfPages();
               doc.setFontSize(10);
               doc.text(`Page ${data.pageNumber} of ${pageCount}`, data.settings.margin.left, doc.internal.pageSize.height - 10);
           };

           // Generate PDF with AutoTable and include header/footer
           doc.autoTable({
               head: [tableHeaders],      // Table headers
               body: tableRows,           // Table rows
               startY: 20,                // Start position on Y-axis
               margin: { top: 20 },       // Adjust top margin for header
               didDrawPage: (data) => {   // Add header and footer on each page
                   header(data);          // Call header function
                   footer(data);          // Call footer function
               }
           });


           // Save and download the generated PDF
           doc.save('list of callteachernotif.pdf'); // Automatically downloads the file as 'firestore-data.pdf'
       } catch (error) {
           console.error('Error generating PDF from Firestore: ', error);
       }
   });
//----
      // Reference to Complaint Student collection
      const collectionRef8 = collection(db, 'ComplaintStudent');

      // Generate and download PDF on link click
      document.getElementById('downloadLink8').addEventListener('click', async (event) => {
       event.preventDefault();  // Prevent link default behavior
       
       // Access jsPDF from the global namespace
       const { jsPDF } = window.jspdf;
       const doc = new jsPDF(); // Create a new jsPDF instance

       // Fetch data from Firestore collection
       try {
           const querySnapshot =  await getDocs(collectionRef8);

           // Prepare the table header and rows
           const tableHeaders = ['Date', 'Time', 'Complainant Name' ,'Student Name','Complaint', 'Remarks']; // Define the table headers
           const tableRows = []; // Array to hold the table rows

           // Loop through the Firestore documents and add them as rows
           querySnapshot.forEach((docSnapshot) => {
               const data = docSnapshot.data();
               const rowData = [];

               // Add details if it exists, else add a placeholder
               rowData.push(data.ComplaintDate || 'N/A');
               rowData.push(data.ComplaintTime || 'N/A');
               rowData.push(data.ComplainantName || 'N/A');
               rowData.push(data.StudentName || 'N/A');
               rowData.push(data.ReasonofComplaint || 'N/A');
               rowData.push(data.Remarks || 'N/A');

               // Add the row to the table
               tableRows.push(rowData);
           });

           // Define header and footer rendering functions
           const header = (data) => {
               doc.setFontSize(12);
               doc.text('ACADEMIC CONCERN AND CONSULTATION SCHEDULING SYSTEM', data.settings.margin.left, 10);  // Custom header text
               doc.setFontSize(10);
               doc.text('List of Copmplaint by Faculty Members', data.settings.margin.left, 15);  // Custom header text

           };

           const footer = (data) => {
               let pageCount = doc.internal.getNumberOfPages();
               doc.setFontSize(10);
               doc.text(`Page ${data.pageNumber} of ${pageCount}`, data.settings.margin.left, doc.internal.pageSize.height - 10);
           };

           // Generate PDF with AutoTable and include header/footer
           doc.autoTable({
               head: [tableHeaders],      // Table headers
               body: tableRows,           // Table rows
               startY: 20,                // Start position on Y-axis
               margin: { top: 20 },       // Adjust top margin for header
               didDrawPage: (data) => {   // Add header and footer on each page
                   header(data);          // Call header function
                   footer(data);          // Call footer function
               }
           });


           // Save and download the generated PDF
           doc.save('list of complaintbyfaculty.pdf'); // Automatically downloads the file as 'firestore-data.pdf'
       } catch (error) {
           console.error('Error generating PDF from Firestore: ', error);
       }
   });
//----
      // Reference to Complaint Faculty collection
      const collectionRef7 = collection(db, 'ComplaintFaculty');

      // Generate and download PDF on link click
      document.getElementById('downloadLink7').addEventListener('click', async (event) => {
       event.preventDefault();  // Prevent link default behavior
       
       // Access jsPDF from the global namespace
       const { jsPDF } = window.jspdf;
       const doc = new jsPDF(); // Create a new jsPDF instance

       // Fetch data from Firestore collection
       try {
           const querySnapshot =  await getDocs(collectionRef7);

           // Prepare the table header and rows
           const tableHeaders = ['Date', 'Time', 'Complainant Student Name' ,'Teacher Name','Complaint', 'Remarks']; // Define the table headers
           const tableRows = []; // Array to hold the table rows

           // Loop through the Firestore documents and add them as rows
           querySnapshot.forEach((docSnapshot) => {
               const data = docSnapshot.data();
               const rowData = [];

               // Add details if it exists, else add a placeholder
               rowData.push(data.ComplaintDate || 'N/A');
               rowData.push(data.ComplaintTime || 'N/A');
               rowData.push(data.ComplainantName || 'N/A');
               rowData.push(data.TeacherName || 'N/A');
               rowData.push(data.ReasonofComplaint || 'N/A');
               rowData.push(data.Remarks || 'N/A');

               // Add the row to the table
               tableRows.push(rowData);
           });

           // Define header and footer rendering functions
           const header = (data) => {
               doc.setFontSize(12);
               doc.text('ACADEMIC CONCERN AND CONSULTATION SCHEDULING SYSTEM', data.settings.margin.left, 10);  // Custom header text
               doc.setFontSize(10);
               doc.text('List of Copmplaint by Student', data.settings.margin.left, 15);  // Custom header text

           };

           const footer = (data) => {
               let pageCount = doc.internal.getNumberOfPages();
               doc.setFontSize(10);
               doc.text(`Page ${data.pageNumber} of ${pageCount}`, data.settings.margin.left, doc.internal.pageSize.height - 10);
           };

           // Generate PDF with AutoTable and include header/footer
           doc.autoTable({
               head: [tableHeaders],      // Table headers
               body: tableRows,           // Table rows
               startY: 20,                // Start position on Y-axis
               margin: { top: 20 },       // Adjust top margin for header
               didDrawPage: (data) => {   // Add header and footer on each page
                   header(data);          // Call header function
                   footer(data);          // Call footer function
               }
           });


           // Save and download the generated PDF
           doc.save('list of complaintbystudent.pdf'); // Automatically downloads the file as 'firestore-data.pdf'
       } catch (error) {
           console.error('Error generating PDF from Firestore: ', error);
       }
   });
//----
      // Reference to Student and Faculty Consultation collection
      const collectionRef6 = collection(db, 'StudentAndFacultyConsultation');

      // Generate and download PDF on link click
      document.getElementById('downloadLink6').addEventListener('click', async (event) => {
       event.preventDefault();  // Prevent link default behavior
       
       // Access jsPDF from the global namespace
       const { jsPDF } = window.jspdf;
       const doc = new jsPDF(); // Create a new jsPDF instance

       // Fetch data from Firestore collection
       try {
           const querySnapshot =  await getDocs(collectionRef6);

           // Prepare the table header and rows
           const tableHeaders = ['Date', 'Time', 'Student Name' ,'Teacher Name','Concern','Details','Status', 'Remarks']; // Define the table headers
           const tableRows = []; // Array to hold the table rows

           // Loop through the Firestore documents and add them as rows
           querySnapshot.forEach((docSnapshot) => {
               const data = docSnapshot.data();
               const rowData = [];

               // Add details if it exists, else add a placeholder
               rowData.push(data.ConsultationDate || 'N/A');
               rowData.push(data.ConsultationStartEndTime || 'N/A');
               rowData.push(data.StudentName || 'N/A');
               rowData.push(data.TeacherName || 'N/A');
               rowData.push(data.ConsultationConcern || 'N/A');
               rowData.push(data.ConsultationDescription || 'N/A');
               rowData.push(data.ConsultationRequestStatus || 'N/A');
               rowData.push(data.Response || 'N/A');

               // Add the row to the table
               tableRows.push(rowData);
           });

           // Define header and footer rendering functions
           const header = (data) => {
               doc.setFontSize(12);
               doc.text('ACADEMIC CONCERN AND CONSULTATION SCHEDULING SYSTEM', data.settings.margin.left, 10);  // Custom header text
               doc.setFontSize(10);
               doc.text('List of Student and Faculty Consultation', data.settings.margin.left, 15);  // Custom header text

           };

           const footer = (data) => {
               let pageCount = doc.internal.getNumberOfPages();
               doc.setFontSize(10);
               doc.text(`Page ${data.pageNumber} of ${pageCount}`, data.settings.margin.left, doc.internal.pageSize.height - 10);
           };

           // Generate PDF with AutoTable and include header/footer
           doc.autoTable({
               head: [tableHeaders],      // Table headers
               body: tableRows,           // Table rows
               startY: 20,                // Start position on Y-axis
               margin: { top: 20 },       // Adjust top margin for header
               didDrawPage: (data) => {   // Add header and footer on each page
                   header(data);          // Call header function
                   footer(data);          // Call footer function
               }
           });


           // Save and download the generated PDF
           doc.save('list of studentandfaculty.pdf'); // Automatically downloads the file as 'firestore-data.pdf'
       } catch (error) {
           console.error('Error generating PDF from Firestore: ', error);
       }
   });
//----
      // Reference to Student Consultation Request collection
      const collectionRef5 = collection(db, 'StudentRequestConsultation');

      // Generate and download PDF on link click
      document.getElementById('downloadLink5').addEventListener('click', async (event) => {
       event.preventDefault();  // Prevent link default behavior
       
       // Access jsPDF from the global namespace
       const { jsPDF } = window.jspdf;
       const doc = new jsPDF(); // Create a new jsPDF instance

       // Fetch data from Firestore collection
       try {
           const querySnapshot =  await getDocs(collectionRef5);

           // Prepare the table header and rows
           const tableHeaders = ['Date', 'Time', 'Student Name' ,'Teacher Name','Concern','Details','Status']; // Define the table headers
           const tableRows = []; // Array to hold the table rows

           // Loop through the Firestore documents and add them as rows
           querySnapshot.forEach((docSnapshot) => {
               const data = docSnapshot.data();
               const rowData = [];

               // Add details if it exists, else add a placeholder
               rowData.push(data.Date || 'N/A');
               rowData.push(data.ConsultationStartEndTime || 'N/A');
               rowData.push(data.StudentName || 'N/A');
               rowData.push(data.TeacherName || 'N/A');
               rowData.push(data.ConsultationConcern || 'N/A');
               rowData.push(data.ConsultationDescription || 'N/A');
               rowData.push(data.Status || 'N/A');

               // Add the row to the table
               tableRows.push(rowData);
           });

           // Define header and footer rendering functions
           const header = (data) => {
               doc.setFontSize(12);
               doc.text('ACADEMIC CONCERN AND CONSULTATION SCHEDULING SYSTEM', data.settings.margin.left, 10);  // Custom header text
               doc.setFontSize(10);
               doc.text('List of Student Consultation Request', data.settings.margin.left, 15);  // Custom header text

           };

           const footer = (data) => {
               let pageCount = doc.internal.getNumberOfPages();
               doc.setFontSize(10);
               doc.text(`Page ${data.pageNumber} of ${pageCount}`, data.settings.margin.left, doc.internal.pageSize.height - 10);
           };

           // Generate PDF with AutoTable and include header/footer
           doc.autoTable({
               head: [tableHeaders],      // Table headers
               body: tableRows,           // Table rows
               startY: 20,                // Start position on Y-axis
               margin: { top: 20 },       // Adjust top margin for header
               didDrawPage: (data) => {   // Add header and footer on each page
                   header(data);          // Call header function
                   footer(data);          // Call footer function
               }
           });


           // Save and download the generated PDF
           doc.save('list of studentrequest.pdf'); // Automatically downloads the file as 'firestore-data.pdf'
       } catch (error) {
           console.error('Error generating PDF from Firestore: ', error);
       }
   });
//----
      // Reference to Faculty Availability collection
      const collectionRef4 = collection(db, 'FacultyConsultationHours');

      // Generate and download PDF on link click
      document.getElementById('downloadLink4').addEventListener('click', async (event) => {
       event.preventDefault();  // Prevent link default behavior
       
       // Access jsPDF from the global namespace
       const { jsPDF } = window.jspdf;
       const doc = new jsPDF(); // Create a new jsPDF instance

       // Fetch data from Firestore collection
       try {
           const querySnapshot =  await getDocs(collectionRef4);

           // Prepare the table header and rows
           const tableHeaders = ['Teacher Name','Date', 'Time', 'Status']; // Define the table headers
           const tableRows = []; // Array to hold the table rows

           // Loop through the Firestore documents and add them as rows
           querySnapshot.forEach((docSnapshot) => {
               const data = docSnapshot.data();
               const rowData = [];

               // Add details if it exists, else add a placeholder
               rowData.push(data.TeacherName || 'N/A');
               rowData.push(data.SelectedDate || 'N/A');
               rowData.push(data.ConsultationHour || 'N/A');
               rowData.push(data.Status || 'N/A');

               // Add the row to the table
               tableRows.push(rowData);
           });

           // Define header and footer rendering functions
           const header = (data) => {
               doc.setFontSize(12);
               doc.text('ACADEMIC CONCERN AND CONSULTATION SCHEDULING SYSTEM', data.settings.margin.left, 10);  // Custom header text
               doc.setFontSize(10);
               doc.text('List of Faculty Availability', data.settings.margin.left, 15);  // Custom header text

           };

           const footer = (data) => {
               let pageCount = doc.internal.getNumberOfPages();
               doc.setFontSize(10);
               doc.text(`Page ${data.pageNumber} of ${pageCount}`, data.settings.margin.left, doc.internal.pageSize.height - 10);
           };

           // Generate PDF with AutoTable and include header/footer
           doc.autoTable({
               head: [tableHeaders],      // Table headers
               body: tableRows,           // Table rows
               startY: 20,                // Start position on Y-axis
               margin: { top: 20 },       // Adjust top margin for header
               didDrawPage: (data) => {   // Add header and footer on each page
                   header(data);          // Call header function
                   footer(data);          // Call footer function
               }
           });


           // Save and download the generated PDF
           doc.save('list of facultyavail.pdf'); // Automatically downloads the file as 'firestore-data.pdf'
       } catch (error) {
           console.error('Error generating PDF from Firestore: ', error);
       }
   });
//----
        // Reference to STUDENTS collection
        const collectionRef3 = collection(db, 'Students');

        // Generate and download PDF on link click
        document.getElementById('downloadLink3').addEventListener('click', async (event) => {
         event.preventDefault();  // Prevent link default behavior
         
         // Access jsPDF from the global namespace
         const { jsPDF } = window.jspdf;
         const doc = new jsPDF(); // Create a new jsPDF instance
 
         // Fetch data from Firestore collection
         try {
             const querySnapshot =  await getDocs(collectionRef3);
 
             // Prepare the table header and rows
             const tableHeaders = ['Student Number', 'Last Name', 'First Name', 'Email Add', 'Status']; // Define the table headers
             const tableRows = []; // Array to hold the table rows
 
             // Loop through the Firestore documents and add them as rows
             querySnapshot.forEach((docSnapshot) => {
                 const data = docSnapshot.data();
                 const rowData = [];
 
                 // Add details if it exists, else add a placeholder
                 rowData.push(data.StudentId || 'N/A');
                 rowData.push(data.LastName || 'N/A');
                 rowData.push(data.FirstName || 'N/A');
                 rowData.push(data.Username || 'N/A');
 
                 // Add "name" if it exists, else add a placeholder
                 if (data.Remarks == "ON") {
                     rowData.push('Actived');
                 }else {
                     rowData.push('Deactivated');
                 }
 
                 // Add the row to the table
                 tableRows.push(rowData);
             });
 
             // Define header and footer rendering functions
             const header = (data) => {
                 doc.setFontSize(12);
                 doc.text('ACADEMIC CONCERN AND CONSULTATION SCHEDULING SYSTEM', data.settings.margin.left, 10);  // Custom header text
                 doc.setFontSize(10);
                 doc.text('List of Studnts', data.settings.margin.left, 15);  // Custom header text
 
             };
 
             const footer = (data) => {
                 let pageCount = doc.internal.getNumberOfPages();
                 doc.setFontSize(10);
                 doc.text(`Page ${data.pageNumber} of ${pageCount}`, data.settings.margin.left, doc.internal.pageSize.height - 10);
             };
 
             // Generate PDF with AutoTable and include header/footer
             doc.autoTable({
                 head: [tableHeaders],      // Table headers
                 body: tableRows,           // Table rows
                 startY: 20,                // Start position on Y-axis
                 margin: { top: 20 },       // Adjust top margin for header
                 didDrawPage: (data) => {   // Add header and footer on each page
                     header(data);          // Call header function
                     footer(data);          // Call footer function
                 }
             });
 
 
             // Save and download the generated PDF
             doc.save('list of students.pdf'); // Automatically downloads the file as 'firestore-data.pdf'
         } catch (error) {
             console.error('Error generating PDF from Firestore: ', error);
         }
     });
//----
       // Reference to TEACHERS collection
       const collectionRef2 = collection(db, 'Teachers');

       // Generate and download PDF on link click
       document.getElementById('downloadLink2').addEventListener('click', async (event) => {
        event.preventDefault();  // Prevent link default behavior
        
        // Access jsPDF from the global namespace
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF(); // Create a new jsPDF instance

        // Fetch data from Firestore collection
        try {
            const querySnapshot =  await getDocs(collectionRef2);

            // Prepare the table header and rows
            const tableHeaders = ['Last Name', 'First Name', 'Department', 'Email Add', 'Status']; // Define the table headers
            const tableRows = []; // Array to hold the table rows

            // Loop through the Firestore documents and add them as rows
            querySnapshot.forEach((docSnapshot) => {
                const data = docSnapshot.data();
                const rowData = [];

                // Add details if it exists, else add a placeholder
                rowData.push(data.LastName || 'N/A');
                rowData.push(data.FirstName || 'N/A');
                rowData.push(data.Department || 'N/A');
                rowData.push(data.FacultyUsername || 'N/A');

                // Add "name" if it exists, else add a placeholder
                if (data.Remarks == "ON") {
                    rowData.push('Actived');
                }else {
                    rowData.push('Deactivated');
                }

                // Add the row to the table
                tableRows.push(rowData);
            });

            // Define header and footer rendering functions
            const header = (data) => {
                doc.setFontSize(12);
                doc.text('ACADEMIC CONCERN AND CONSULTATION SCHEDULING SYSTEM', data.settings.margin.left, 10);  // Custom header text
                doc.setFontSize(10);
                doc.text('List of Teachers', data.settings.margin.left, 15);  // Custom header text

            };

            const footer = (data) => {
                let pageCount = doc.internal.getNumberOfPages();
                doc.setFontSize(10);
                doc.text(`Page ${data.pageNumber} of ${pageCount}`, data.settings.margin.left, doc.internal.pageSize.height - 10);
            };

            // Generate PDF with AutoTable and include header/footer
            doc.autoTable({
                head: [tableHeaders],      // Table headers
                body: tableRows,           // Table rows
                startY: 20,                // Start position on Y-axis
                margin: { top: 20 },       // Adjust top margin for header
                didDrawPage: (data) => {   // Add header and footer on each page
                    header(data);          // Call header function
                    footer(data);          // Call footer function
                }
            });


            // Save and download the generated PDF
            doc.save('list of Teachers.pdf'); // Automatically downloads the file as 'firestore-data.pdf'
        } catch (error) {
            console.error('Error generating PDF from Firestore: ', error);
        }
    });
//----
       // Reference to SYSTEM USERS collection
        const collectionRef = collection(db, 'SystemUser');

       // Generate and download PDF on link click
       document.getElementById('downloadLink').addEventListener('click', async (event) => {
        event.preventDefault();  // Prevent link default behavior
        
        // Access jsPDF from the global namespace
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF(); // Create a new jsPDF instance

        // Fetch data from Firestore collection
        try {
            const querySnapshot =  await getDocs(collectionRef);

            // Prepare the table header and rows
            const tableHeaders = ['Employee ID', 'Last Name', 'First Name', 'Email Add', 'Access']; // Define the table headers
            const tableRows = []; // Array to hold the table rows

            // Loop through the Firestore documents and add them as rows
            querySnapshot.forEach((docSnapshot) => {
                const data = docSnapshot.data();
                const rowData = [];

                // Add details if it exists, else add a placeholder
                rowData.push(data.employeeid || 'N/A');
                rowData.push(data.lastname || 'N/A');
                rowData.push(data.firstname || 'N/A');
                rowData.push(data.emailadd || 'N/A');

                // Add "name" if it exists, else add a placeholder
                if (data.access == 1) {
                    rowData.push('School Admin');
                }else if(data.access == 2){
                    rowData.push('Academic Head');
                }else {
                    rowData.push('Program Head');
                }

                // Add the row to the table
                tableRows.push(rowData);
            });

            // Define header and footer rendering functions
            const header = (data) => {
                doc.setFontSize(12);
                doc.text('ACADEMIC CONCERN AND CONSULTATION SCHEDULING SYSTEM', data.settings.margin.left, 10);  // Custom header text
                doc.setFontSize(10);
                doc.text('List of System Users', data.settings.margin.left, 15);  // Custom header text

            };

            const footer = (data) => {
                let pageCount = doc.internal.getNumberOfPages();
                doc.setFontSize(10);
                doc.text(`Page ${data.pageNumber} of ${pageCount}`, data.settings.margin.left, doc.internal.pageSize.height - 10);
            };

            // Generate PDF with AutoTable and include header/footer
            doc.autoTable({
                head: [tableHeaders],      // Table headers
                body: tableRows,           // Table rows
                startY: 20,                // Start position on Y-axis
                margin: { top: 20 },       // Adjust top margin for header
                didDrawPage: (data) => {   // Add header and footer on each page
                    header(data);          // Call header function
                    footer(data);          // Call footer function
                }
            });


            // Save and download the generated PDF
            doc.save('list of system users.pdf'); // Automatically downloads the file as 'firestore-data.pdf'
        } catch (error) {
            console.error('Error generating PDF from Firestore: ', error);
        }
    });

 //----     
      // Retrieve user data from session storage
        const userData = JSON.parse(sessionStorage.getItem('userData'));

        if (userData) {
          if(userData.access == 1){
            document.getElementById('userDetails').innerHTML = 
             `
                <Label style="color: whitesmoke;">${userData.firstname}</label>
                <Label style="color: whitesmoke;"> ${userData.lastname}</Label>
                <Label style="color: whitesmoke;">    **School Administrator</Label>
            `;

          }else if(userData.access == 2){
            document.getElementById('userDetails').innerHTML = 
             `
                <Label style="color: whitesmoke;">${userData.firstname}</label>
                <Label style="color: whitesmoke;"> ${userData.lastname}</Label>
                <Label style="color: whitesmoke;">    **Academic Head</Label>
            `;
          }else{
            document.getElementById('userDetails').innerHTML = 
             `
                <Label style="color: whitesmoke;">${userData.firstname}</label>
                <Label style="color: whitesmoke;"> ${userData.lastname}</Label>
                <Label style="color: whitesmoke;">    **Program Head</Label>
            `;
          }
            
        } else {
            window.location.href = 'index.html';  // Redirect to login if no session data
        }

          // Handle Sign Out with SweetAlert confirmation
          document.getElementById('signOutBtn').addEventListener('click', function() {
            Swal.fire({
                title: 'Are you sure?',
                text: "You will be logged out!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, sign me out!'
            }).then((result) => {
                if (result.isConfirmed) {
                    const auth = getAuth();
                    
                    signOut(auth).then(() => {
                        // Clear session storage
                        sessionStorage.clear();

                        // Show success message
                        Swal.fire(
                            'Signed Out!',
                            'You have successfully signed out.',
                            'success'
                        ).then(() => {
                            // Redirect to login page after sign-out
                            window.location.href = 'index.html';
                        });
                    }).catch((error) => {
                        Swal.fire('Error', 'Sign-out failed: ' + error.message, 'error');
                    });
                }
            });
        });
    </script>
  </body>
</html>